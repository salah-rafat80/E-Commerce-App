import 'package:dartz/dartz.dart';
import 'package:ecommerce_app/features/Auth/data/model/model_use.dart';
import 'package:ecommerce_app/features/profile/data/repo/profile_repo.dart';
import 'package:ecommerce_app/features/profile/manager/cubit/profile_state.dart';
import 'package:flutter_bloc/flutter_bloc.dart';

class ProfileCubit extends Cubit<ProfileState> {
  ProfileCubit() : super(ProfileInitial());

  static ProfileCubit get(context) => BlocProvider.of(context);

  Future<void> getProfile() async {
    try {
      print("ğŸ”„ Ø¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
      emit(ProfileDataLoading());

      Either<String, List<UserModel>> result = await ProfileRepo.getinstance().UserData(); // âœ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙƒÙ€ Method

      result.fold(
            (failureMessage) {
          print("âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: $failureMessage");
          emit(ProfileDataError(message: failureMessage));
        },
            (userDataList) {
          if (userDataList.isEmpty || userDataList[0].user == null) {
            print("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…");
            emit(ProfileDataError(message: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ§Ø­Ø©"));
            return;
          }

          print("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­: ${userDataList.length} Ù…Ø³ØªØ®Ø¯Ù…(ÙŠÙ†)");
          emit(ProfileDataSuccess(UserdataList: userDataList));
        },
      );
    } catch (e) {
      print("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: $e");
      emit(ProfileDataError(message: "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${e.toString()}"));
    }
  }

}
